# 登录提示弹窗功能 - 变更日志

## 日期
2026-02-18

## 需求描述
- 用户可以无需登录访问：首页、商品列表页、商品详情页
- 访问其他需要登录的页面（购物车、订单等）时，弹出登录提示弹窗
- **不强制跳转到登录页**，用户可以选择关闭弹窗继续浏览

## 技术实现

### 新增文件

1. **`frontend/src/components/LoginPromptModal/index.tsx`**
   - 登录提示弹窗组件
   - 使用纯 CSS 动画实现流畅的打开/关闭效果
   - 支持毛玻璃背景、渐变装饰等视觉效果

2. **`frontend/src/components/LoginPromptModal/styles.css`**
   - 弹窗样式文件
   - 包含响应式设计
   - 动画关键帧定义

### 修改文件

1. **`frontend/src/components/ProtectedRoute/index.tsx`**
   - 移除强制跳转逻辑
   - 新增 `AuthPlaceholder` 占位组件
   - 未登录用户访问受保护页面时：
     - 首次进入显示登录提示弹窗
     - 关闭弹窗后显示占位内容，提示需要登录
   - 用户可随时点击"立即登录"按钮跳转到登录页

## 用户体验流程

### 访问受保护页面（如购物车）
1. 未登录用户访问 `/cart`
2. 页面显示登录提示弹窗（优雅的视觉设计）
3. 用户可以：
   - 点击「立即登录」→ 跳转到登录页（带 redirect 参数）
   - 点击「稍后再说」或关闭弹窗 → 显示占位提示页
4. 占位页显示「请先登录」提示和登录按钮

### 公开页面
- 首页 `/`
- 商品列表 `/products`
- 商品详情 `/products/:id`
- 登录页 `/login`

以上页面无需登录即可访问。

---

## 问题修复

### 问题1：弹窗颜色与主题不匹配
**问题描述**：弹窗使用紫色系（#6366f1），与项目橙色主题（#FF6B35）不匹配

**修复内容**：
- `LoginPromptModal/styles.css` - 将所有紫色改为橙色系
  - 遮罩层：rgba(26, 26, 46, 0.5)
  - 主容器背景：渐变为 rgba(255, 255, 255, 0.98) → rgba(255, 250, 245, 1)
  - 装饰圆圈：橙色渐变（#FF8C61 → #FF6B35）
  - 图标背景：橙色渐变
  - 功能标签：橙色主题
  - 登录按钮：橙色渐变

- `ProtectedRoute/index.tsx` - 更新 `AuthPlaceholder` 组件颜色
  - 图标背景：#FFF5F0 → #FFE8DD
  - 图标描边：#FF6B35
  - 登录按钮：橙色渐变

### 问题2：公开页面 API 401 时强制跳转登录页
**问题描述**：未登录用户访问公开页面（首页、商品列表）时，如果 API 返回 401 错误，会被强制跳转到登录页

**修复内容**：

**前端修复**：
- `frontend/src/utils/request.ts` - 修改 `clearAuthAndRedirect` 函数
  - 添加公开页面判断逻辑
  - 公开页面路径：`/`, `/products`, `/login`
  - 公开页面不显示错误消息，不强制跳转
  - 仅在受保护页面显示错误并跳转

**后端修复（核心修复）**：
- `src/main/java/com/example/ddd/infrastructure/config/SecurityConfig.java`
  - 将商品和分类接口添加到 `PUBLIC_ENDPOINTS`
  - `/products/**` - 商品列表和详情
  - `/categories/**` - 分类列表
  - 这样未登录用户可以直接访问商品数据，不再返回 401 错误

---

## 测试结果

### 测试环境
- 前端：运行正常
- 后端：运行正常

### 测试用例
| 用例 | 预期结果 | 实际结果 | 状态 |
|------|---------|---------|------|
| 未登录访问首页 | 正常显示 | 正常显示 | ✅ |
| 未登录访问商品列表 | 正常显示 | 正常显示 | ✅ |
| 未登录访问购物车 | 显示登录弹窗 | 显示登录弹窗（橙色主题）| ✅ |
| 关闭弹窗后显示占位 | 显示占位页 | 显示占位页 | ✅ |
| 公开页面 API 401 | 不跳转登录页 | 不跳转 | ✅ |