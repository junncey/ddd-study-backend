# 修复CORS跨域问题 - 支持127.0.0.1访问

## 问题描述

1. 前端使用非localhost地址（如 `http://127.0.0.1:5173`）打开网页后无法连接后台API
2. CORS配置中存在未使用的3000端口放行

## 根本原因

1. CORS配置中只允许 `http://localhost:3000` 和 `http://localhost:5173` 作为源地址。当用户使用 `127.0.0.1` 访问时，浏览器认为是不同的源，从而阻止跨域请求
2. 前端实际使用的是Vite默认端口5173，3000端口未被使用

## 解决方案

修改 `SecurityConfig.java` 中的 `CORS_ALLOWED_ORIGINS` 配置，添加对 `127.0.0.1` 的支持。

**修改文件**: `src/main/java/com/example/ddd/infrastructure/config/SecurityConfig.java`

**修改内容**:
```java
// 修改前
@Value("${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:5173}")
private String allowedOrigins;

// 修改后
@Value("${CORS_ALLOWED_ORIGINS:http://localhost:5173,http://127.0.0.1:5173}")
private String allowedOrigins;
```

## 测试结果

### 编译验证
- 后端编译：✅ 通过

### 功能验证
待验证：使用 `http://127.0.0.1:5173` 访问前端，测试API调用是否正常。

## 使用说明

用户现在可以使用以下任一地址访问前端：
- `http://localhost:5173`
- `http://127.0.0.1:5173`

如需添加其他允许的源地址，可通过环境变量 `CORS_ALLOWED_ORIGINS` 配置：
```bash
# Windows
set CORS_ALLOWED_ORIGINS=http://localhost:5173,http://127.0.0.1:5173,http://192.168.1.100:5173

# Linux/Mac
export CORS_ALLOWED_ORIGINS=http://localhost:5173,http://127.0.0.1:5173,http://192.168.1.100:5173
```

**注意**：已移除未使用的3000端口放行，仅保留前端实际使用的5173端口。

## 修改日期

2025-02-18
