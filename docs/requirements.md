# Shoping 电商平台需求文档

**版本**: 1.0.0
**日期**: 2025-02-16
**状态**: 已实现

---

## 一、项目概述

### 1.1 项目背景
基于 DDD（领域驱动设计）六边形架构的 B2C 多店铺电商平台系统，提供完整的电商购物体验。

### 1.2 技术架构
- **后端**: Spring Boot 3.5 + MyBatis Plus + MySQL + Redis
- **前端**: React 18 + TypeScript + Ant Design + React Query + Zustand
- **架构**: 六边形架构（Hexagonal Architecture）

### 1.3 系统用户
- **消费者**: 浏览商品、购物、下单、支付
- **店铺商家**: 管理商品、处理订单
- **平台管理员**: 审核店铺、系统管理

---

## 二、功能模块

### 2.1 用户认证模块

#### 功能列表
| 功能编号 | 功能名称 | 优先级 | 状态 |
|----------|----------|--------|------|
| AUTH-001 | 用户注册 | P0 | ✅ 已实现 |
| AUTH-002 | 用户登录 | P0 | ✅ 已实现 |
| AUTH-003 | Token 刷新 | P0 | ✅ 已实现 |
| AUTH-004 | 用户登出 | P1 | ✅ 已实现 |
| AUTH-005 | 获取当前用户 | P1 | ✅ 已实现 |

#### 接口定义
```
POST /api/auth/register - 用户注册
POST /api/auth/login - 用户登录
POST /api/auth/refresh - 刷新Token
POST /api/auth/logout - 用户登出
GET /api/auth/current - 获取当前用户信息
```

#### 业务规则
1. 用户名：3-20个字符，只能包含字母、数字和下划线
2. 密码：至少6个字符，使用BCrypt加密存储
3. 邮箱：必填，唯一性校验
4. Token有效期：AccessToken 7天，RefreshToken 30天

---

### 2.2 商品模块

#### 功能列表
| 功能编号 | 功能名称 | 优先级 | 状态 |
|----------|----------|--------|------|
| PROD-001 | 商品列表 | P0 | ✅ 已实现 |
| PROD-002 | 商品详情 | P0 | ✅ 已实现 |
| PROD-003 | 商品搜索 | P1 | ✅ 已实现 |
| PROD-004 | 分类筛选 | P1 | ✅ 已实现 |
| PROD-005 | 商品SKU | P0 | ✅ 已实现 |

#### 实体定义
- **Product**: 商品主表（名称、描述、价格、状态）
- **ProductSku**: 商品规格（规格名、价格、库存）
- **ProductImage**: 商品图片
- **Category**: 商品分类（树形结构）

#### 商品状态
| 状态值 | 状态名 | 说明 |
|--------|--------|------|
| 0 | 草稿 | 新建商品 |
| 1 | 在售 | 可购买 |
| 2 | 售罄 | 库存为0 |
| 3 | 下架 | 已下架 |

---

### 2.3 购物车模块

#### 功能列表
| 功能编号 | 功能名称 | 优先级 | 状态 |
|----------|----------|--------|------|
| CART-001 | 查看购物车 | P0 | ✅ 已实现 |
| CART-002 | 添加商品 | P0 | ✅ 已实现 |
| CART-003 | 修改数量 | P0 | ✅ 已实现 |
| CART-004 | 删除商品 | P0 | ✅ 已实现 |

#### 业务规则
1. 添加商品时保存价格快照
2. 购物车数据按用户隔离
3. 支持批量操作

---

### 2.4 订单模块

#### 功能列表
| 功能编号 | 功能名称 | 优先级 | 状态 |
|----------|----------|--------|------|
| ORD-001 | 创建订单 | P0 | ✅ 已实现 |
| ORD-002 | 订单列表 | P0 | ✅ 已实现 |
| ORD-003 | 订单详情 | P0 | ✅ 已实现 |
| ORD-004 | 取消订单 | P1 | ✅ 已实现 |
| ORD-005 | 确认收货 | P1 | ✅ 已实现 |

#### 订单状态流转
```
待支付(0) → 已支付(1) → 已发货(2) → 已完成(3)
    ↓           ↓           ↓
已取消(4)   退款中(5)   退款中(5)
                            ↓
                        已退款(6)
```

#### 实体定义
- **Order**: 订单主表
- **OrderItem**: 订单明细
- **OrderStatusLog**: 订单状态日志

---

### 2.5 支付模块

#### 功能列表
| 功能编号 | 功能名称 | 优先级 | 状态 |
|----------|----------|--------|------|
| PAY-001 | 发起支付 | P0 | ✅ 已实现 |
| PAY-002 | 支付回调 | P0 | ✅ 已实现 |
| PAY-003 | 支付查询 | P1 | ✅ 已实现 |

#### 支付方式
| 编码 | 名称 |
|------|------|
| 1 | 支付宝 |
| 2 | 微信支付 |
| 3 | 余额支付 |

#### 支付状态
| 状态值 | 状态名 |
|--------|--------|
| 0 | 待支付 |
| 1 | 支付成功 |
| 2 | 支付失败 |
| 3 | 退款中 |
| 4 | 已退款 |

---

### 2.6 地址模块

#### 功能列表
| 功能编号 | 功能名称 | 优先级 | 状态 |
|----------|----------|--------|------|
| ADDR-001 | 地址列表 | P0 | ✅ 已实现 |
| ADDR-002 | 新增地址 | P0 | ✅ 已实现 |
| ADDR-003 | 编辑地址 | P1 | ✅ 已实现 |
| ADDR-004 | 删除地址 | P1 | ✅ 已实现 |
| ADDR-005 | 设为默认 | P1 | ✅ 已实现 |

#### 实体定义
- **Address**: 收货地址（收货人、电话、省市区、详细地址、是否默认）

---

### 2.7 店铺模块

#### 功能列表
| 功能编号 | 功能名称 | 优先级 | 状态 |
|----------|----------|--------|------|
| SHOP-001 | 店铺注册 | P0 | ✅ 已实现 |
| SHOP-002 | 店铺审核 | P0 | ✅ 已实现 |
| SHOP-003 | 店铺设置 | P1 | ✅ 已实现 |

#### 店铺状态
| 状态值 | 状态名 |
|--------|--------|
| 0 | 待审核 |
| 1 | 已通过 |
| 2 | 已拒绝 |
| 3 | 已暂停 |
| 4 | 已关闭 |

---

### 2.8 评价模块

#### 功能列表
| 功能编号 | 功能名称 | 优先级 | 状态 |
|----------|----------|--------|------|
| REV-001 | 发表评价 | P1 | ✅ 已实现 |
| REV-002 | 评价列表 | P1 | ✅ 已实现 |
| REV-003 | 商家回复 | P2 | ✅ 已实现 |

---

## 三、非功能性需求

### 3.1 性能需求
- 页面加载时间 < 3秒
- API 响应时间 < 500ms
- 支持 1000 并发用户

### 3.2 安全需求
- 密码使用 BCrypt 加密
- JWT Token 认证
- HTTPS 传输（生产环境）
- SQL 注入防护
- XSS 防护

### 3.3 可用性需求
- 系统可用性 > 99.9%
- 数据备份策略
- 错误处理和日志记录

---

## 四、数据库设计

### 4.1 核心表清单
| 表名 | 说明 |
|------|------|
| t_user | 用户表 |
| t_role | 角色表 |
| t_permission | 权限表 |
| t_user_role | 用户角色关联表 |
| t_role_permission | 角色权限关联表 |
| t_address | 收货地址表 |
| t_shop | 店铺表 |
| t_shop_setting | 店铺设置表 |
| t_category | 商品分类表 |
| t_product | 商品表 |
| t_product_sku | 商品SKU表 |
| t_product_image | 商品图片表 |
| t_cart | 购物车表 |
| t_cart_item | 购物车明细表 |
| t_order | 订单表 |
| t_order_item | 订单明细表 |
| t_order_status_log | 订单状态日志表 |
| t_payment | 支付记录表 |
| t_review | 评价表 |
| t_review_reply | 评价回复表 |
| t_favorite | 收藏表 |
| t_login_log | 登录日志表 |

---

## 五、接口规范

### 5.1 统一响应格式
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {},
  "timestamp": 1771238133542
}
```

### 5.2 状态码定义
| 状态码 | 说明 |
|--------|------|
| 200 | 成功 |
| 400 | 参数错误 |
| 401 | 未认证 |
| 403 | 无权限 |
| 404 | 资源不存在 |
| 500 | 服务器错误 |

---

## 六、部署要求

### 6.1 环境要求
- JDK 17+
- Node.js 18+
- MySQL 8.0+
- Redis 6.0+

### 6.2 配置项
- 服务端口: 8080
- 数据库端口: 3307
- 数据库名: ddd_demo
- Redis端口: 6379

---

## 七、版本历史

| 版本 | 日期 | 说明 |
|------|------|------|
| 1.0.0 | 2025-02-16 | 初始版本，完成核心功能 |
